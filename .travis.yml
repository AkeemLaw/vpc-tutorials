# only run the test on master
branches:
  only:
  - master

# to easily encrypt values: https://travis-encrypt.github.io/

# https://docs.travis-ci.com/user/languages/minimal-and-generic/
language: minimal

# https://docs.travis-ci.com/user/notifications/#configuring-slack-notifications
notifications:
  slack:
    secure: l1RIDDiYcHqfCg0cHjHY7Tg+AaeZJ6mAtN9Z4dlrWwJpQy6mOePJ2dAjp6OJsPqaU+RNseGSsCiPdFnZT7y7R/w4dRymUieHK4exCfEa/1lVJPqf4+69OUcFdr4m1SeytApH0zv/jDf23EelusJlWxvRlC836HjWGCHSicVR+aYcJ5LMrHKKtnEr/f0eyJoNEtEsW7yJhOoEO9NznckMZXjVEtumOcPDZQ4mRpWZrXWADES8NOjNIWmECNwPQVQv4GlrMAQrw75pLBJ/8+Z6pMv0Fask9HFE5ThwscY7Ja4D7e3CXQdUJ/655PH154NqRnOZhLLA99+zheMpQJwtfCjdHWRDgGrnO6+chm5UlTzkHtEZGQ6/IowsJ38xTVBjBhkudE3Q6zvI0zQ7RfiLgA7LSyUy61YJczikSjJppXA4Ti/Y6NkbZJv/BC9SgGeQhDITAiPO6k4UTdNqk9O9SgokiPgT0dJAqg+1QfMKgWOMNREsLAmxUY8/lnymgnRReopk/j14AXtkoDvPAaiQDotKzu+2UFXo5iE0FE+VfDOR4hWVJwXGl3zNDuTWCXgXx0m9Iy31zkssR6t2aLxiIh3wyY0nMkFfR//2PqX8sFgS69vCKr6XL/o5U7GqNnnui4yiylI1Uyjliy/ebH+jhIiAKVAwZPQTBRXXg9f+SR0=

services:
  - docker

# https://docs.travis-ci.com/user/build-matrix/
env:
  global:
    - TEST_VPC_NAME=automated-tests-do-not-delete-us-south
    - RESOURCE_GROUP=automated-tests
    - REGION=us-south
    - DATACENTER=dal10
    # KEYS=a,b,c,d
    - secure: QK9ex1sq1SCuumea0zJcFlrpZ8K3NaSH/h9WQ6d+r/RUN0yRlcafyLFrOS7HqcfhXX0plj+50dpb6kIl3PYNexxhH9X/oF4RLzvFBDLWRc63esFECP7lUoOdT9QElqadfNWguiXXseSA2IYHvWBJiGZdVYTuobxmOAEv9OOMSMSSWCKxGoNIAa8sAxpY3SSomVKZkf/c535hJBf7oro2KN7s++hUJ4c3dvUvLBdrrNx/eki+GAGguEaayLxjAuv/EVJ27jWgZH58tPhu7DGDWdeJGvYnx/FGCdZM2cV3c/kAtEJY6hIa3rm3uEj6hexyV36IaWmBosgn6np7XmT7ZHYkbT9MkD7ulvgE1Vsvt0jlcp/EbAWi6PzaShCJssLdIHetxqxOP+rclDkeKyoFPTMSgy6gKVi6aQdhayARPzklcNpWazoWm03RSuUicRHKxwrAua1ahy/UtkT+s8UKO96RVAJdOCOoae/mvZtvf0Aeqpr4YfWYtLdXYAJGpeC4T0FQ3iyfxUZvWFEn2PGQ20IbAQ+fT76GHyefzWaOIRHrzAOZwV4QPhDI+Mn8ETAJ2e6Af3MRw7rPKJwjhwYuMSv2tV1ZSnuD9nfNV2REIcCSR9c2qYCWpdOcAHBeH025ruaxzB1zjBu2ANIZqmfWfJ/zVlMru/eN3eBWbnOkpQs=
  matrix:
    - SCENARIO=cleanup-initial TEST=tests/teardown.sh
    - SCENARIO=vpc-one-vsi TEST=tests/vpc-one-vsi/create-with-terraform.sh
    - SCENARIO=cleanup-vpc-one-vsi TEST=tests/teardown.sh
    - SCENARIO=vpc-public-app-private-backend TEST=tests/vpc-public-app-private-backend/create.sh
    - SCENARIO=cleanup-vpc-public-app-private-backend TEST=tests/teardown.sh
    - SCENARIO=vpc-site2site-vpn TEST=tests/vpc-site2site-vpn/create.sh TEARDOWN=tests/vpc-site2site-vpn/teardown.sh
    - SCENARIO=cleanup-vpc-site2site-vpn TEST=tests/teardown.sh
    - SCENARIO=vpc-cockroachdb-mzr TEST=tests/vpc-cockroachdb-mzr/create.sh TEARDOWN=tests/vpc-cockroachdb-mzr/teardown.sh
    - SCENARIO=cleanup-vpc-cockroachdb-mzr TEST=tests/teardown.sh

script:
  - |
    docker run -i --volume $PWD:/root/mnt/home --workdir /root/mnt/home \
      --env SCENARIO \
      --env TEST \
      --env TEARDOWN \
      --env API_KEY \
      --env REGION \
      --env DATACENTER \
      --env RESOURCE_GROUP \
      --env TEST_VPC_NAME \
      --env KEYS \
      --env JOB_ID=$TRAVIS_JOB_ID \
      l2fprod/bxshell tests/runner.sh
